<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tally Prime - Enterprise ERP</title>
    <!-- Security: Content Security Policy -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'wasm-unsafe-eval' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data:; connect-src 'self' https: http: ws: wss:; object-src 'none';">
    <!-- Tailwind CSS (compiled output) -->
    <link rel="stylesheet" href="../renderer/styles/output.css">
    <!-- Design System - Single source of truth (load first) -->
    <link rel="stylesheet" href="../renderer/styles/design-system.css">
    <!-- Dynamic Font Sizing System -->
    <link rel="stylesheet" href="../renderer/styles/font-dynamics.css">
    <!-- Global Theme System -->
    <link rel="stylesheet" href="../renderer/styles/global-theme.css">
    <!-- Enhanced Theme CSS (Overrides global with premium styles) -->
    <link rel="stylesheet" href="../renderer/styles/enhanced-theme.css">
    <!-- Application Styles -->
    <link rel="stylesheet" href="../renderer/styles/styles.css">
    <link rel="stylesheet" href="../renderer/styles/styles-app.css">
    <link rel="stylesheet" href="../renderer/styles/styles-tailwind.css">
    <!-- Security Policy -->
    <script src="../main/security-policy.js"></script>
    <style>
        /* ── Essential overrides that bridge Tailwind + Design System ── */
        :root {
            --primary-600: #496da0;
            --primary-700: #37537b;
            --primary-500: #5e86ba;
            --primary-900: #131e31;
            --primary-400: #779cc4;
            --sidebar-bg: #f0f4f8;
            --background-color: #f8fafc;
        }

        body {
            background-color: var(--ds-bg-app, var(--background-color));
            color: var(--ds-text-primary, #1f2937);
            margin: 0;
            padding: 0;
        }

        /* ── Custom scrollbar ── */
        .custom-scrollbar::-webkit-scrollbar { width: 6px; height: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 9999px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #9ca3af; }

        /* ── Notification System ── */
        #notification-container {
            position: fixed;
            top: 16px;
            right: 16px;
            z-index: 10000;
            max-width: 380px;
            pointer-events: none;
        }

        .notification {
            background: var(--ds-bg-surface, #ffffff);
            border-radius: var(--ds-radius-xl, 12px);
            box-shadow: var(--ds-shadow-lg);
            padding: 14px 18px;
            margin-bottom: 10px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
            animation: notifSlideIn 0.25s var(--ds-ease, ease-out);
            pointer-events: all;
            border-left: 4px solid var(--ds-primary-500, #5e86ba);
            min-width: 280px;
        }
        .notification.success { border-left-color: var(--ds-success-500, #10b981); }
        .notification.error   { border-left-color: var(--ds-danger-500, #ef4444); }
        .notification.warning { border-left-color: var(--ds-warning-500, #f59e0b); }
        .notification.info    { border-left-color: var(--ds-info-500, #3b82f6); }

        .notification-icon { font-size: 20px; flex-shrink: 0; min-width: 24px; text-align: center; }
        .notification-content { flex: 1; display: flex; flex-direction: column; gap: 2px; }
        .notification-title { font-weight: 600; color: var(--ds-text-primary); font-size: 13px; line-height: 1.4; margin: 0; }
        .notification-message { color: var(--ds-text-secondary); font-size: 12px; line-height: 1.5; margin: 0; }
        .notification-close {
            cursor: pointer; color: var(--ds-text-disabled); font-size: 18px; line-height: 1;
            padding: 0; background: none; border: none; flex-shrink: 0;
            transition: color var(--ds-duration-fast);
        }
        .notification-close:hover { color: var(--ds-text-primary); }
        .notification-progress { height: 2px; background: rgba(0,0,0,0.06); border-radius: 2px; overflow: hidden; margin-top: 8px; }
        .notification-progress-bar { height: 100%; background: currentColor; animation: notifProgress linear forwards; }

        @keyframes notifSlideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes notifProgress { from { width: 100%; } to { width: 0%; } }

        /* ── Error Boundary ── */
        .error-boundary-container { position: fixed; top: 16px; right: 16px; z-index: 9999; max-width: 380px; }
        .error-boundary-toast {
            background: var(--ds-bg-surface, #fff);
            border: 2px solid var(--ds-danger-500, #ef4444);
            border-radius: var(--ds-radius-lg, 10px);
            padding: 12px; margin-bottom: 10px;
            box-shadow: var(--ds-shadow-lg);
            animation: notifSlideIn 0.25s ease-out;
        }
        .error-boundary-content { display: flex; align-items: center; gap: 12px; }
        .error-boundary-icon { font-size: 22px; flex-shrink: 0; }
        .error-boundary-message { flex: 1; min-width: 0; }
        .error-boundary-message h4 { margin: 0; color: var(--ds-danger-600); font-size: 13px; font-weight: 600; }
        .error-boundary-message p { margin: 4px 0 0; color: var(--ds-text-secondary); font-size: 11px; word-wrap: break-word; }
        .error-boundary-close {
            background: none; border: none; font-size: 18px; cursor: pointer;
            color: var(--ds-text-disabled); padding: 0; width: 24px; height: 24px;
            display: flex; align-items: center; justify-content: center; flex-shrink: 0;
        }
        .error-boundary-close:hover { color: var(--ds-danger-500); }

        /* ── Splash Screen ── */
        #splash {
            position: fixed; inset: 0;
            background: linear-gradient(135deg, var(--ds-primary-600, #496da0) 0%, var(--ds-primary-800, #253956) 100%);
            display: flex; align-items: center; justify-content: center; z-index: 9999;
        }
        .splash-content { text-align: center; color: white; }
        .splash-logo { font-size: 2.5rem; margin-bottom: 0.75rem; font-weight: 800; }
        .splash-title { font-size: 1.25rem; font-weight: 700; margin-bottom: 0.375rem; }
        .splash-loading-text { font-size: 0.8125rem; opacity: 0.8; margin-bottom: 1.5rem; }
        .splash-progress-bar { width: 180px; height: 3px; background: rgba(255,255,255,0.2); border-radius: 2px; overflow: hidden; margin: 0 auto; }
        .splash-progress-fill { width: 30%; height: 100%; background: white; animation: splashLoad 1.5s ease-in-out infinite; }
        @keyframes splashLoad { 0% { width: 30%; margin-left: 0; } 50% { width: 70%; margin-left: 15%; } 100% { width: 30%; margin-left: 70%; } }

        #errorDisplay { display: none; }
    </style>
</head>

<body>
    <!-- Splash/Loading Screen -->
    <div id="splash">
        <div class="splash-content">
            <div class="splash-logo">T</div>
            <div class="splash-title">Tally Prime</div>
            <div class="splash-loading-text">Loading...</div>
            <div class="splash-progress-bar">
                <div class="splash-progress-fill"></div>
            </div>
        </div>
    </div>

    <!-- Error display (hidden by default - only logs to console) -->
    <div id="errorDisplay"></div>

    <!-- Notification Container -->
    <div id="notification-container"></div>

    <!-- XLSX Library for Excel Export -->
    <script src="../../node_modules/xlsx/dist/xlsx.full.min.js"></script>

    <!-- Upgrade Services - Load before app.js -->
    <script src="../renderer/services/logger.js"></script>
    <script src="../renderer/services/telemetry.js"></script>
    <script src="../renderer/services/offline-queue.js"></script>
    <script src="../renderer/services/sync-reconciliation.js"></script>
    <script src="../renderer/components/error-boundary.js"></script>
    <script src="../renderer/config/upgrade-config.js"></script>

    <!-- Service Scripts -->
    <script src="../renderer/services/theme-manager.js"></script>
    <script src="../renderer/services/config.js"></script>
    <script src="../renderer/services/apiConfig.js"></script>
    <script src="../renderer/services/utils.js"></script>
    <script src="../renderer/services/auth.js"></script>
    <script src="../renderer/services/user-profile.js"></script>
    <script src="../renderer/services/session-manager.js"></script>
    <script src="../renderer/services/notification-service.js"></script>
    <script src="../renderer/services/notification-util.js"></script>
    <script src="../renderer/services/license-validator.js"></script>
    <script src="../renderer/services/sync-state-manager.js"></script>
    <script src="../renderer/components/notification-center.js"></script>
    <script src="../renderer/services/sync-helper.js"></script>
    <script src="../renderer/services/base-page.js"></script>
    <script src="../renderer/services/api.js"></script>
    <script src="../renderer/services/sync-diagnostics.js"></script>
    <script src="../renderer/services/sync-scheduler.js"></script>
    <script src="../renderer/services/background-sync-scheduler.js"></script>
    <script src="../renderer/services/app-initializer.js"></script>
    <script src="../renderer/services/router.js"></script>

    <!-- Redux -->
    <script src="../renderer/redux/store.js"></script>

    <!-- Pages Loader -->
    <script src="../renderer/pages-loader.js"></script>

    <!-- UI Component Library -->
    <script src="../renderer/components/ui-components.js"></script>
    <script src="../renderer/components/layout.js"></script>
    <script src="../renderer/components/popup.js"></script>

    <!-- Page Modules (All pages) -->
    <script src="../renderer/pages/dashboard.js"></script>
    <script src="../renderer/pages/auth.js"></script>
    <script src="../renderer/pages/users.js"></script>
    <script src="../renderer/pages/sync-settings.js"></script>
    <script src="../renderer/pages/settings.js"></script>
    <script src="../renderer/pages/import-company.js"></script>
    <script src="../renderer/pages/company-sync.js"></script>
    <script src="../renderer/pages/profile.js"></script>
    <script src="../renderer/pages/system-info.js"></script>
    <script src="../renderer/pages/tutorial.js"></script>
    <script src="../renderer/pages/support.js"></script>
    <script src="../renderer/pages/update-app.js"></script>
    <script src="../renderer/pages/purchase.js"></script>

    <!-- Components -->
    <script src="../renderer/components/sync-controller.js"></script>

    <!-- Main App Entry Point -->
    <script src="../renderer/app.js"></script>

    <!-- Initialization -->
    <script src="../main/init.js"></script>
</body>

</html>